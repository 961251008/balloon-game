<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <!-- 分享元数据 -->
  <meta property="og:title" content="气球大师 - 我的得分挑战" />
  <meta property="og:description" content="我在气球大师游戏中获得了高分，快来挑战我吧！" />
  <meta property="og:type" content="game" />
  <meta property="og:image" content="https://picsum.photos/400/300?random=balloon" />
  <meta property="og:url" content="https://xxx.github.io/balloon-game/" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="气球大师 - 我的得分挑战" />
  <meta name="twitter:description" content="我在气球大师游戏中获得了高分，快来挑战我吧！" />
  <title>气球大师（可分享版）</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind自定义颜色和字体 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#4F46E5',
            secondary: '#EC4899',
            accent: '#8B5CF6',
            success: '#10B981',
            danger: '#EF4444',
            dark: '#1E293B'
          },
          fontFamily: {
            game: ['"Comic Sans MS"', '"Marker Felt"', 'sans-serif']
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .balloon-shadow {
        filter: drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));
      }
      .pulse-light {
        animation: pulse-light 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      @keyframes pulse-light {
        0%, 100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }
      .float {
        animation: float 3s ease-in-out infinite;
      }
      @keyframes float {
        0%, 100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }
      .speed-slider {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        height: 6px;
        border-radius: 3px;
        background: #e0e0e0;
        outline: none;
      }
      .speed-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        /* ...existing code for thumb... */
      }
      /* 为 Firefox 添加滑块拇指样式 */
      .speed-slider::-moz-range-thumb {
        -moz-appearance: none;
        appearance: none;
        /* 同样的拇指样式（宽度、高度、背景等） */
      }
      .share-btn {
        transition: all 0.2s ease;
      }
      .share-btn:hover {
        transform: translateY(-3px);
      }
    }
  </style>
</head>

<body class="bg-gradient-to-b from-blue-50 to-indigo-100 min-h-screen font-game overflow-hidden text-dark">
  <!-- 开始界面 -->
  <div id="start-screen" class="absolute inset-0 flex flex-col items-center justify-center z-30 transition-opacity duration-500">
    <h1 class="text-[clamp(2rem,8vw,4rem)] font-bold text-primary mb-6 text-center drop-shadow-lg">气球大师</h1>
    
    <div class="relative w-40 h-40 mb-8">
      <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-24 h-32 bg-red-500 rounded-full balloon-shadow float" style="animation-delay: 0s;"></div>
      <div class="absolute top-8 left-[20%] transform -translate-x-1/2 w-20 h-28 bg-yellow-400 rounded-full balloon-shadow float" style="animation-delay: 0.5s;"></div>
      <div class="absolute top-4 right-[20%] transform -translate-x-1/2 w-22 h-30 bg-green-500 rounded-full balloon-shadow float" style="animation-delay: 1s;"></div>
      <div class="absolute bottom-0 left-1/2 transform -translate-x-1/2 w-1.5 h-8 bg-gray-400"></div>
    </div>
    
    <p class="text-lg text-center mb-10 px-6">点击气球得分，让它们飞走则扣分！</p>
    
    <button id="start-btn" class="bg-primary hover:bg-primary/90 text-white text-xl py-4 px-10 rounded-full shadow-lg transform transition hover:scale-105 active:scale-95 flex items-center gap-2">
      <i class="fa fa-play"></i> 开始游戏
    </button>
    
    <button id="how-to-play-btn" class="mt-6 text-indigo-600 hover:text-indigo-800 transition">
      <i class="fa fa-question-circle"></i> 游戏说明
    </button>
  </div>
  
  <!-- 游戏说明界面 -->
  <div id="instructions-screen" class="absolute inset-0 bg-white/95 z-40 flex flex-col items-center justify-center p-6 hidden">
    <h2 class="text-2xl font-bold text-primary mb-6">游戏说明</h2>
    <ul class="list-disc pl-6 mb-8 space-y-3">
      <li>点击屏幕上出现的气球得分</li>
      <li>每个气球价值10分</li>
      <li>如果气球飞出屏幕，扣5分</li>
      <li>游戏时间为60秒</li>
      <li>可在暂停菜单中调节气球速度（最高100倍速）</li>
      <li>游戏结束后可分享你的成绩！</li>
    </ul>
    <button id="back-btn" class="bg-gray-200 hover:bg-gray-300 text-dark py-2 px-6 rounded-full transition">
      返回
    </button>
  </div>
  
  <!-- 游戏界面 -->
  <div id="game-screen" class="absolute inset-0 hidden">
    <!-- 游戏顶部信息栏 -->
    <div class="flex justify-between items-center p-4 bg-white/80 backdrop-blur-sm shadow-sm z-20">
      <div class="bg-dark/10 px-3 py-1 rounded-full text-sm">
        <i class="fa fa-clock-o mr-1"></i> <span id="time-left">60</span>s
      </div>
      <div class="bg-primary/10 px-3 py-1 rounded-full text-sm">
        <i class="fa fa-star mr-1"></i> <span id="score">0</span>分
      </div>
    </div>
    
    <!-- 游戏画布 -->
    <canvas id="game-canvas" class="absolute inset-0 w-full h-full"></canvas>
    
    <!-- 暂停按钮 -->
    <button id="pause-btn" class="absolute bottom-6 right-6 bg-white/80 backdrop-blur-sm w-12 h-12 rounded-full shadow-lg flex items-center justify-center z-20 transition hover:bg-white">
      <i class="fa fa-pause text-dark"></i>
    </button>
  </div>
  
  <!-- 暂停界面 -->
  <div id="pause-screen" class="absolute inset-0 bg-black/50 backdrop-blur-sm z-30 flex flex-col items-center justify-center hidden">
    <div class="bg-white rounded-2xl p-8 max-w-xs w-full shadow-2xl">
      <h2 class="text-2xl font-bold text-center mb-6">游戏暂停</h2>
      
      <!-- 速度调节控制 -->
      <div class="mb-6">
        <div class="flex justify-between items-center mb-2">
          <label for="speed-control" class="text-sm text-gray-600">气球速度</label>
          <span id="speed-value" class="text-sm font-medium text-primary">100x</span>
        </div>
        <input 
          type="range" 
          id="speed-control" 
          min="1" 
          max="100" 
          value="100" 
          class="speed-slider w-full"
        >
        <div class="flex justify-between text-xs text-gray-500 mt-1">
          <span>1x</span>
          <span>100x</span>
        </div>
      </div>
      
      <div class="flex flex-col gap-3">
        <button id="resume-btn" class="bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition">
          继续游戏
        </button>
        <button id="restart-btn" class="bg-gray-200 hover:bg-gray-300 text-dark py-3 rounded-lg transition">
          重新开始
        </button>
        <button id="quit-btn" class="bg-gray-100 hover:bg-gray-200 text-dark py-3 rounded-lg transition">
          返回主页
        </button>
      </div>
    </div>
  </div>
  
  <!-- 结束界面 -->
  <div id="end-screen" class="absolute inset-0 bg-black/50 backdrop-blur-sm z-30 flex flex-col items-center justify-center hidden">
    <div class="bg-white rounded-2xl p-8 max-w-xs w-full shadow-2xl">
      <h2 class="text-2xl font-bold text-center mb-2">游戏结束</h2>
      <p class="text-gray-500 text-center mb-6">太棒了！你的得分是：</p>
      <div class="text-4xl font-bold text-primary text-center mb-6" id="final-score">0</div>
      
      <!-- 分享区域 -->
      <div class="mb-6">
        <p class="text-center text-sm text-gray-500 mb-3">分享你的成绩</p>
        <div class="flex justify-center gap-4">
          <button id="system-share-btn" class="share-btn bg-primary text-white w-10 h-10 rounded-full flex items-center justify-center">
            <i class="fa fa-share-alt"></i>
          </button>
          <button id="wechat-share-btn" class="share-btn bg-green-500 text-white w-10 h-10 rounded-full flex items-center justify-center">
            <i class="fa fa-weixin"></i>
          </button>
          <button id="qq-share-btn" class="share-btn bg-blue-400 text-white w-10 h-10 rounded-full flex items-center justify-center">
            <i class="fa fa-qq"></i>
          </button>
          <button id="weibo-share-btn" class="share-btn bg-red-500 text-white w-10 h-10 rounded-full flex items-center justify-center">
            <i class="fa fa-weibo"></i>
          </button>
        </div>
      </div>
      
      <div class="flex flex-col gap-3">
        <button id="play-again-btn" class="bg-primary hover:bg-primary/90 text-white py-3 rounded-lg transition">
          再玩一次
        </button>
        <button id="back-to-home-btn" class="bg-gray-200 hover:bg-gray-300 text-dark py-3 rounded-lg transition">
          返回主页
        </button>
      </div>
    </div>
  </div>

  <script>
    // 获取DOM元素
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const pauseScreen = document.getElementById('pause-screen');
    const endScreen = document.getElementById('end-screen');
    const instructionsScreen = document.getElementById('instructions-screen');
    
    const startBtn = document.getElementById('start-btn');
    const howToPlayBtn = document.getElementById('how-to-play-btn');
    const backBtn = document.getElementById('back-btn');
    const pauseBtn = document.getElementById('pause-btn');
    const resumeBtn = document.getElementById('resume-btn');
    const restartBtn = document.getElementById('restart-btn');
    const quitBtn = document.getElementById('quit-btn');
    const playAgainBtn = document.getElementById('play-again-btn');
    const backToHomeBtn = document.getElementById('back-to-home-btn');
    const speedControl = document.getElementById('speed-control');
    const speedValue = document.getElementById('speed-value');
    
    // 分享按钮
    const systemShareBtn = document.getElementById('system-share-btn');
    const wechatShareBtn = document.getElementById('wechat-share-btn');
    const qqShareBtn = document.getElementById('qq-share-btn');
    const weiboShareBtn = document.getElementById('weibo-share-btn');
    
    const timeLeftEl = document.getElementById('time-left');
    const scoreEl = document.getElementById('score');
    const finalScoreEl = document.getElementById('final-score');
    
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    
    // 游戏变量
    let gameInterval;
    let spawnInterval;
    let timeLeft = 60;
    let score = 0;
    let balloons = [];
    let isPaused = false;
    let balloonSpeedLevel = 100; // 默认设置为最高速度100
    // 当前游戏URL（替换为你的实际URL）
    const gameUrl = "https://xxx.github.io/balloon-game/";    
    // 气球颜色
    const balloonColors = [
      '#EF4444', // 红色
      '#F59E0B', // 橙色
      '#FBBF24', // 黄色
      '#10B981', // 绿色
      '#3B82F6', // 蓝色
      '#8B5CF6', // 紫色
      '#EC4899'  // 粉色
    ];
    
    // 设置Canvas尺寸
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    
    // 初始化Canvas
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    // 气球类
    class Balloon {
      constructor() {
        this.radius = Math.random() * 20 + 30; // 30-50px
        this.x = Math.random() * (canvas.width - this.radius * 2) + this.radius;
        this.y = canvas.height + this.radius;
        this.color = balloonColors[Math.floor(Math.random() * balloonColors.length)];
        
        // 速度计算：基础速度 * 速度等级（1-100）
        const baseSpeed = Math.random() * 0.1 + 0.1; 
        this.speed = baseSpeed * balloonSpeedLevel;
        
        this.popped = false;
        this.popperSize = 0;
      }
      
      update() {
        if (this.popped) {
          // 气球破裂动画
          this.popperSize += 2;
          return;
        }
        
        this.y -= this.speed;
        
        // 气球飞出屏幕
        if (this.y + this.radius < 0) {
          return true;
        }
        return false;
      }
      
      draw() {
        if (this.popped) {
          // 绘制破裂效果
          ctx.beginPath();
          ctx.fillStyle = this.color;
          ctx.arc(this.x, this.y, this.popperSize, 0, Math.PI * 2);
          ctx.fill();
          return;
        }
        
        // 绘制气球
        ctx.beginPath();
        ctx.fillStyle = this.color;
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
        
        // 绘制气球高光
        ctx.beginPath();
        ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.arc(this.x - this.radius * 0.3, this.y - this.radius * 0.3, this.radius * 0.2, 0, Math.PI * 2);
        ctx.fill();
        
        // 绘制气球绳
        ctx.beginPath();
        ctx.strokeStyle = '#6B7280';
        ctx.lineWidth = 2;
        ctx.moveTo(this.x, this.y + this.radius);
        ctx.lineTo(this.x, this.y + this.radius + 15);
        ctx.stroke();
      }
      
      pop() {
        if (!this.popped) {
          this.popped = true;
          score += 10;
          scoreEl.textContent = score;
          return true;
        }
        return false;
      }
      
      isPointInside(x, y) {
        if (this.popped) return false;
        const dx = x - this.x;
        const dy = y - this.y;
        return dx * dx + dy * dy <= this.radius * this.radius;
      }
    }
    
    // 检查触摸位置是否击中气球
    function checkBalloonHit(x, y) {
      for (let i = balloons.length - 1; i >= 0; i--) {
        if (balloons[i].isPointInside(x, y)) {
          balloons[i].pop();
          break;
        }
      }
    }
    
    // 处理触摸事件
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault(); // 防止屏幕滚动
      if (isPaused) return;
      
      const touch = e.touches[0];
      const rect = canvas.getBoundingClientRect();
      const x = touch.clientX - rect.left;
      const y = touch.clientY - rect.top;
      
      checkBalloonHit(x, y);
    }, { passive: false });
    
    // 处理鼠标点击（用于桌面调试）
    canvas.addEventListener('click', (e) => {
      if (isPaused) return;
      
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      checkBalloonHit(x, y);
    });
    
    // 更新游戏状态
    function updateGame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // 更新和绘制气球
      for (let i = balloons.length - 1; i >= 0; i--) {
        const balloon = balloons[i];
        const offScreen = balloon.update();
        
        if (offScreen) {
          // 气球飞出屏幕，扣分
          score = Math.max(0, score - 5);
          scoreEl.textContent = score;
          balloons.splice(i, 1);
        } else if (balloon.popped && balloon.popperSize > balloon.radius * 1.5) {
          // 移除完全破裂的气球
          balloons.splice(i, 1);
        } else {
          balloon.draw();
        }
      }
    }
    
    // 生成新气球（高速度下降低生成频率，否则难以处理）
    function spawnBalloon() {
      if (!isPaused && balloons.length < 5) { // 限制最大气球数量为5（高速下）
        balloons.push(new Balloon());
      }
    }
    
    // 开始游戏
    function startGame() {
      // 重置游戏状态
      timeLeft = 60;
      score = 0;
      balloons = [];
      isPaused = false;
      
      timeLeftEl.textContent = timeLeft;
      scoreEl.textContent = score;
      
      // 显示游戏界面
      startScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
      pauseScreen.classList.add('hidden');
      endScreen.classList.add('hidden');
      
      // 启动游戏循环
      if (gameInterval) clearInterval(gameInterval);
      gameInterval = setInterval(updateGame, 16); // ~60 FPS
      
      // 启动气球生成器（高速度下降低生成频率）
      if (spawnInterval) clearInterval(spawnInterval);
      spawnInterval = setInterval(spawnBalloon, 1500); // 1.5秒生成一个气球
      
      // 启动计时器
      const timer = setInterval(() => {
        if (isPaused) return;
        
        timeLeft--;
        timeLeftEl.textContent = timeLeft;
        
        if (timeLeft <= 0) {
          clearInterval(timer);
          endGame();
        }
      }, 1000);
    }
    
    // 暂停游戏
    function pauseGame() {
      isPaused = true;
      pauseScreen.classList.remove('hidden');
    }
    
    // 恢复游戏
    function resumeGame() {
      isPaused = false;
      pauseScreen.classList.add('hidden');
    }
    
    // 结束游戏
    function endGame() {
      clearInterval(gameInterval);
      clearInterval(spawnInterval);
      
      finalScoreEl.textContent = score;
      gameScreen.classList.add('hidden');
      endScreen.classList.remove('hidden');
    }
    
    // 更新速度显示
    function updateSpeedDisplay() {
      balloonSpeedLevel = parseInt(speedControl.value);
      speedValue.textContent = `${balloonSpeedLevel}x`;
      
      // 高速度下调整气球生成频率
      if (!isPaused && spawnInterval) {
        clearInterval(spawnInterval);
        // 速度越高，生成间隔越长（避免过多气球同时出现）
        const spawnDelay = Math.min(3000, 500 + balloonSpeedLevel * 20);
        spawnInterval = setInterval(spawnBalloon, spawnDelay);
      }
    }
    
    // 分享功能实现
    function getShareText() {
      return `我在气球大师游戏中获得了${score}分！快来挑战我吧！`;
    }
    
    // 系统分享（使用Web Share API）
    function systemShare() {
      if (navigator.share) {
        navigator.share({
          title: '气球大师',
          text: getShareText(),
          url: gameUrl,
        })
        .then(() => console.log('分享成功'))
        .catch((error) => console.log('分享失败:', error));
      } else {
        // 不支持Web Share API时的降级处理
        alert('您的浏览器不支持分享功能，请手动复制链接分享');
      }
    }
    
    // 微信分享（实际环境需要接入微信JS-SDK）
    function wechatShare() {
      try {
        // 这里只是模拟，实际项目中需要使用微信JS-SDK
        alert('已唤起微信分享，实际环境中会打开微信分享界面');
      } catch (e) {
        alert('请在微信中打开以使用微信分享功能');
      }
    }
    
    // QQ分享
    function qqShare() {
      const shareText = encodeURIComponent(getShareText());
      const shareUrl = encodeURIComponent(gameUrl);
      const qqShareUrl = `https://connect.qq.com/widget/shareqq/index.html?url=${shareUrl}&title=气球大师&summary=${shareText}&pics=https://picsum.photos/400/300?random=balloon&style=203&width=32&height=32`;
      window.open(qqShareUrl, '_blank', 'width=600,height=500');
    }
    
    // 微博分享
    function weiboShare() {
      const shareText = encodeURIComponent(getShareText() + ' ' + gameUrl);
      const weiboShareUrl = `https://service.weibo.com/share/share.php?content=utf-8&url=${encodeURIComponent(gameUrl)}&title=${shareText}&pic=https://picsum.photos/400/300?random=balloon`;
      window.open(weiboShareUrl, '_blank', 'width=600,height=500');
    }
    
    // 事件监听器
    startBtn.addEventListener('click', startGame);
    
    howToPlayBtn.addEventListener('click', () => {
      startScreen.classList.add('hidden');
      instructionsScreen.classList.remove('hidden');
    });
    
    backBtn.addEventListener('click', () => {
      instructionsScreen.classList.add('hidden');
      startScreen.classList.remove('hidden');
    });
    
    pauseBtn.addEventListener('click', pauseGame);
    resumeBtn.addEventListener('click', resumeGame);
    restartBtn.addEventListener('click', startGame);
    quitBtn.addEventListener('click', () => {
      clearInterval(gameInterval);
      clearInterval(spawnInterval);
      pauseScreen.classList.add('hidden');
      startScreen.classList.remove('hidden');
      gameScreen.classList.add('hidden');
    });
    
    playAgainBtn.addEventListener('click', startGame);
    backToHomeBtn.addEventListener('click', () => {
      endScreen.classList.add('hidden');
      startScreen.classList.remove('hidden');
    });
    
    // 速度控制事件
    speedControl.addEventListener('input', updateSpeedDisplay);
    
    // 分享按钮事件
    systemShareBtn.addEventListener('click', systemShare);
    wechatShareBtn.addEventListener('click', wechatShare);
    qqShareBtn.addEventListener('click', qqShare);
    weiboShareBtn.addEventListener('click', weiboShare);
    
    // 初始化速度显示
    updateSpeedDisplay();
    
    // 防止触摸时页面滚动
    document.body.addEventListener('touchmove', (e) => {
      e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>